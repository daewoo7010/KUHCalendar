<!DOCTYPE html>
<html lang="ko">
{% load group_tags %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>근태관리 시스템</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <style>
        body { background-color: #f8f9fa; }
            :root {
                --main-red: #8b1e2f;
                --main-red-light: #a62c3f;
                --main-red-muted: #f4e7ea;
            }
            body { background-color: #f8f9fa; font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
            .navbar { background-color: var(--main-red); }
            .navbar-brand { font-weight: 700; letter-spacing: -0.2px; }
            .btn-primary, .bg-primary { background-color: var(--main-red) !important; border-color: var(--main-red) !important; }
            .btn-outline-primary { color: var(--main-red); border-color: var(--main-red); }
            .btn-outline-primary:hover { background-color: var(--main-red); color: #fff; }
            .text-primary { color: var(--main-red) !important; }
            .toast-container { z-index: 1080; }
            .quick-links .btn { border-radius: 999px; }
            /* FullCalendar primary buttons to match brand red */
            .fc .fc-button-primary {
                background-color: var(--main-red);
                border-color: var(--main-red);
            }
            .fc .fc-button-primary:hover,
            .fc .fc-button-primary:focus {
                background-color: var(--main-red-light);
                border-color: var(--main-red-light);
            }
            .fc .fc-button-primary:not(:disabled):active,
            .fc .fc-button-primary:active:focus,
            .fc .fc-button-primary.fc-button-active {
                background-color: var(--main-red-light);
                border-color: var(--main-red-light);
                box-shadow: none;
            }
            /* Mobile table scroll helper */
            @media (max-width: 576px) {
                .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }
                .table-responsive > table { min-width: 640px; }
            }
            /* Mobile navbar alignment */
            @media (max-width: 576px) {
                .navbar .container-fluid { flex-direction: column; align-items: stretch; gap: 0.5rem; }
                .navbar-brand { width: 100%; text-align: center; }
                .quick-links { justify-content: center; width: 100%; }
                .navbar .dropdown { align-self: flex-end; }
            }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container-fluid align-items-center">
            <div class="d-flex align-items-center flex-wrap gap-2">
                <a class="navbar-brand" href="{% url 'dashboard' %}"><i class="bi bi-calendar-check me-2"></i>근태관리 시스템</a>
                {% if user.is_authenticated %}
                <div class="quick-links d-flex flex-wrap gap-2 align-items-center">
                    <a class="btn btn-sm btn-outline-light" href="{% url 'dashboard' %}"><i class="bi bi-house-door me-1"></i>대시보드</a>
                    {% if user|has_group:"휴가 결재권자" %}
                    <a class="btn btn-sm btn-outline-light" href="{% url 'leave_approval' %}"><i class="bi bi-clipboard-check me-1"></i>휴가 승인</a>
                    {% endif %}
                    {% if user|has_group:"출장 결재권자" %}
                    <a class="btn btn-sm btn-outline-light" href="{% url 'trip_approval' %}"><i class="bi bi-clipboard2-check me-1"></i>출장 승인</a>
                    {% endif %}
                    {% if user|has_group:"경영관리부" %}
                    <a class="btn btn-sm btn-outline-light" href="{% url 'management_overview' %}"><i class="bi bi-graph-up me-1"></i>경영관리 대시보드</a>
                    {% endif %}
                    {% if user|is_trip_recipient %}
                    <a class="btn btn-sm btn-outline-light" href="{% url 'trip_report_inbox' %}"><i class="bi bi-inbox me-1"></i>외부일정/출장 보고함</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>

            <div class="d-flex">
                {% if user.is_authenticated %}
                    <div class="dropdown ms-2">
                        <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle me-1"></i>{{ user.username }}
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            {% if user|has_group:"관리자" %}
                            <li><a class="dropdown-item" href="{% url 'admin_roles' %}"><i class="bi bi-people-gear me-2"></i>권한 관리</a></li>
                            <li><a class="dropdown-item" href="{% url 'trip_recipients' %}"><i class="bi bi-bell me-2"></i>출장 보고 수신자</a></li>
                                <li><a class="dropdown-item" href="{% url 'admin_users' %}"><i class="bi bi-person-lines-fill me-2"></i>사용자 관리</a></li>
                            <li><hr class="dropdown-divider"></li>
                            {% endif %}
                            <li><a class="dropdown-item" href="{% url 'password_change' %}"><i class="bi bi-key me-2"></i>비밀번호 변경</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form action="{% url 'logout' %}" method="post" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item text-danger"><i class="bi bi-box-arrow-right me-2"></i>로그아웃</button>
                                </form>
                            </li>
                        </ul>
                    </div>
                {% else %}
                    <a class="btn btn-outline-light" href="{% url 'login' %}"><i class="bi bi-box-arrow-in-right me-1"></i>로그인</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- 메시지 토스트 영역 -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        {% if messages %}
            {% for message in messages %}
            <div class="toast show align-items-center text-bg-{{ message.tags|default:'primary' }} border-0 mb-2" role="alert">
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="bi bi-info-circle me-2"></i>{{ message }}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            </div>
            {% endfor %}
        {% endif %}
    </div>

    <div class="container py-4">
        {% block content %}{% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        setTimeout(() => {
            document.querySelectorAll('.toast.show').forEach(t => t.classList.remove('show'));
        }, 3000);
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
