{% extends 'attendance/base.html' %}
{% block content %}
<h4 class="mb-3 d-flex align-items-center gap-2">
    <i class="bi bi-list-check"></i>
    <span>휴가 승인 내역</span>
</h4>
<div class="card shadow-sm border-0 mb-3">
    <div class="card-body">
        <form class="row g-2 align-items-end" method="get">
            <div class="col-md-3">
                <label class="form-label small text-muted mb-1">키워드</label>
                <input type="text" name="q" class="form-control" placeholder="이름, 부서, 사유 검색" value="{{ keyword }}">
            </div>
            <div class="col-md-2">
                <label class="form-label small text-muted mb-1">상태</label>
                <select name="status" class="form-select">
                    {% for value, label in status_choices %}
                    <option value="{{ value }}" {% if status == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label small text-muted mb-1">유형</label>
                <select name="leave_type" class="form-select">
                    <option value="">전체</option>
                    {% for value, label in leave_types %}
                    <option value="{{ value }}" {% if leave_type == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label small text-muted mb-1">시작일</label>
                <input type="date" name="start_from" class="form-control" value="{{ start_from }}">
            </div>
            <div class="col-md-2">
                <label class="form-label small text-muted mb-1">종료일</label>
                <input type="date" name="start_to" class="form-control" value="{{ start_to }}">
            </div>
            <div class="col-md-1 d-flex gap-1">
                <button type="submit" class="btn btn-primary w-100"><i class="bi bi-funnel me-1"></i>적용</button>
            </div>
            <div class="col-12 d-flex justify-content-between flex-wrap gap-2">
                <a class="btn btn-sm btn-outline-secondary" href="{% url 'management_overview' %}"><i class="bi bi-arrow-left me-1"></i>경영관리 대시보드</a>
                <a class="btn btn-sm btn-link text-danger" href="{% url 'leave_history' %}">필터 초기화</a>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm border-0">
    <div class="card-body p-0">
        <div class="px-3 pt-3 d-sm-none text-muted small">모바일에서는 좌우 스크롤로 전체 열을 확인하세요.</div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>사용자</th>
                        <th>부서</th>
                        <th>직책</th>
                        <th>기간</th>
                        <th>유형</th>
                        <th>상태</th>
                        <th>일수</th>
                        <th>사유</th>
                    </tr>
                </thead>
                <tbody>
                    {% for leave in leaves %}
                    <tr>
                        <td>{{ leave.user.username }}</td>
                        <td>{{ leave.user.department }}</td>
                        <td>{{ leave.user.position }}</td>
                        <td>{{ leave.start_date }} ~ {{ leave.end_date }}</td>
                        <td>{{ leave.leave_type }}</td>
                        <td>
                            {% if leave.status == 'approved' %}
                                <span class="badge bg-success-subtle text-success">승인</span>
                            {% elif leave.status == 'rejected' %}
                                <span class="badge bg-danger-subtle text-danger">반려</span>
                            {% else %}
                                <span class="badge bg-warning-subtle text-warning">대기</span>
                            {% endif %}
                        </td>
                        <td>{{ leave.days }}</td>
                        <td class="text-truncate" style="max-width: 360px;">{{ leave.reason }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="8" class="text-center text-muted py-4">조회된 휴가 내역이 없습니다.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer bg-white d-flex justify-content-between align-items-center">
        <div class="small text-muted">총 {{ paginator.count }}건</div>
        <nav>
            <ul class="pagination pagination-sm mb-0">
                {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&status={{ status }}&leave_type={{ leave_type }}&q={{ keyword }}&start_from={{ start_from }}&start_to={{ start_to }}">이전</a></li>
                {% else %}
                <li class="page-item disabled"><span class="page-link">이전</span></li>
                {% endif %}
                <li class="page-item active"><span class="page-link">{{ page_obj.number }}/{{ paginator.num_pages }}</span></li>
                {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&status={{ status }}&leave_type={{ leave_type }}&q={{ keyword }}&start_from={{ start_from }}&start_to={{ start_to }}">다음</a></li>
                {% else %}
                <li class="page-item disabled"><span class="page-link">다음</span></li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>
{% endblock %}
